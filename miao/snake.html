<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <pre></pre>

  <script>
    class snake {
      constructor(width, height) {
        this.width = width
        this.height = height
        this.world = null
        this.snakeLength = 0
        this.headPos = null
        this.tailPos = null
        // this.world[5][5] = 'â†’'
        // this.randomApple()
        // this.isGameOver = false
        this.init()
      }
      init() {
        this.world = Array(this.height).fill(0).map(it => Array(this.width).fill('.'))
        this.world[5][5] = 'â†’'
        this.snakeLength = 1
        this.headPos = {row: 5, rol: 5}
        this.tailPos = {row: 5, rol: 5}
        this.randomApple()
      }


      randomApple() {
        let row = Math.floor(this.height * Math.random())
        let col = Math.floor(this.width * Math.random())
        if (this.world[row][col] == '.') {
          this.world[row][col] = 'A'
        } else {
          this.randomApple()
        }
      }

      getChar(pos) {  //èŽ·å–ç¬¦å·
        
        return this.world[pos.row][pos.col]
       
      }
      setChar(pos, char) {
        this.world[pos.row][pos.col] = char
      }

      // gameOver() {
      //   if (this.isGameOver) {
      //     alert('hh')
      //   }
      // }

      getNext(pos) {  //èŽ·å–snakeçš„ä¸‹ä¸€ä¸ªåæ ‡
        let snakeHeadChar = this.getChar(pos)
        if (snakeHeadChar == 'â†‘') {
          return {row: pos.row - 1, col: pos.col}
        }
        if (snakeHeadChar == 'â†“') {
          return {row: pos.row + 1, col: pos.col}
        }
        if (snakeHeadChar == 'â†') {
          return {row: pos.row, col: pos.col - 1}
        }
        if (snakeHeadChar == 'â†’') {
          return {row: pos.row, col: pos.col + 1}
        }
      }

      next() {
        // if (this.isGameOver) {
        //   return
        // }
        let curHead = this.getChar(this.headPos)  //å¤´åæ ‡ç¬¦å·
        let nextHeadPos = this.getNext(this.headPos)  //ä¸‹ä¸€ä¸ªå¤´åæ ‡
        let nextHead = this.getChar(nextHeadPos)  //ä¸‹ä¸€ä¸ªå¤´åæ ‡ç¬¦å·
        if (nextHead == '.') {  //ç©ºä½ç½®
          this.setChar(nextHeadPos, curHead)
          this.headPos = nextHeadPos //æ›´æ–°è›‡å¤´
        } else if (nextHead == 'A') {
          this.setChar(nextHeadPos, curHead)
          this.headPos = nextHeadPos  //æ›´æ–°è›‡å¤´
          this.randomApple() //å¦‚æžœæ˜¯è‹¹æžœè¿˜è¦è®©ä¸‹ä¸€ä¸ªè‹¹æžœå‡ºçŽ°
        }
        
        if (nextHead == '.') {
          let nextTailPos = this.getNext(this.tailPos)  //ä¸‹ä¸€ä¸ªè›‡å°¾åæ ‡
          this.setChar(this.tailPos, '.')
          this.tailPos = nextTailPos
        }
        return this
      }

      changeDirection(direction) {
        switch(direction) {
          case 'up': return this.setChar(this.headPos,'â†‘')
          case 'down': return this.setChar(this.headPos, 'â†“')
          case 'left': return this.setChar(this.headPos, 'â†')
          case 'right': return this.setChar(this.headPos, 'â†’')
        }
      }

      print() {
        console.log(this.toString())
      }
      toString() {
        return this.world.map(row => {
          return row.map(char => {
            if (char =='.') {
              return 'ðŸ’›'
            } else if (char == 'A'){
              return 'ðŸ’š'
            } else {
              return 'ðŸ§¡'
            }
          }).join('')
        }).join('\n')
      }

    }

    let pre = document.querySelector('pre')
    let box = new snake(20, 20)

    document.addEventListener('keydown', e => {
      // console.log(0)
      if (e.key.startsWith('Arrow')) {  //æŒ‰ä¸‹åŽ»çš„é”®ä»¥arrowå¼€å¤´çš„
        let direction = e.key.slice(5).toLowerCase()
        box.changeDirection(direction)
        clearInterval(id)
        tick()
        id = setInterval(tick, 1000)
      }
    })

    pre.textContent = box.toString()

    function tick() {
      box.next()
      pre.textContent = box.toString()
      console.log(box.toString())
    }

    let id = setInterval(tick, 1000)

  </script>
</body>
</html>